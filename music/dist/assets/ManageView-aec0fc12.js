import{_ as v,p as F,q as k,u as $,v as b,y as E,z as I,s as U,e as T,o as d,c,a as s,n as f,A as i,t as u,j as D,l as C,d as q,B as R,E as B,g as y,C as x,D as N,G as M,H as V,r as _,i as w,I as S,J as j,b as h,w as z,R as A,K as G,f as L,m as O}from"./index-6b728ebc.js";const P={name:"UploadForm",data(){return{is_dragover:!1,uploads:[]}},props:["addSong"],methods:{upload(t){this.is_dragover=!1;const e=t.dataTransfer?[...t.dataTransfer.files]:[...t.target.files];e.forEach(r=>{if(r.type!=="audio/mpeg")return;const p=F(k,`songs/${r.name}`),n=$(p,r),a=this.uploads.push({uploadTask:n,current_progress:0,name:r.name,variant:"bg-blue-400",icon:"fas fa-spinner fa-spin",text_class:""})-1;n.on("state_changed",o=>{const l=o.bytesTransferred/o.totalBytes*100;this.uploads[a].current_progress=l},o=>{this.uploads[a].variant="bg-red-400",this.uploads[a].icon="fas fa-times",this.uploads[a].text="text-red-400",console.log(o)},async()=>{const o={uid:b.currentUser.uid,display_name:b.currentUser.displayName,original_name:n.snapshot.ref.name,modified_name:n.snapshot.ref.name,genre:"",comment_count:0};o.url=await E(n.snapshot.ref);const l=await I(U,o),m=await T(l);this.addSong(m),this.uploads[a].variant="bg-green-400",this.uploads[a].icon="fas fa-check",this.uploads[a].text="text-green-400"})}),console.log(e)},cancelUploads(){this.uploads.forEach(t=>{t.uploadTask.cancel()})}},beforeUnmount(){this.uploads.forEach(t=>{t.uploadTask.cancel()})}},H={class:"bg-white rounded border border-gray-200 relative flex flex-col"},J=s("div",{class:"px-6 pt-6 pb-5 font-bold border-b border-gray-200"},[s("span",{class:"card-title"},"Upload"),s("i",{class:"fas fa-upload float-right text-green-400 text-2xl"})],-1),K={class:"p-6"},Y=s("hr",{class:"my-6"},null,-1),Q={class:"flex h-4 overflow-hidden bg-gray-200 rounded"};function W(t,e,r,p,n,a){return d(),c("div",H,[J,s("div",K,[s("div",{class:f(["w-full px-10 py-20 rounded text-center cursor-pointer border border-dashed border-gray-400 text-gray-400 transition duration-500 hover:text-white hover:bg-green-400 hover:border-green-400 hover:border-solid",{"bg-green-400 border-green-400 border-solid":n.is_dragover}]),onDrag:e[0]||(e[0]=i(()=>{},["prevent","stop"])),onDragstart:e[1]||(e[1]=i(()=>{},["prevent","stop"])),onDragend:e[2]||(e[2]=i(o=>n.is_dragover=!1,["prevent","stop"])),onDragover:e[3]||(e[3]=i(o=>n.is_dragover=!0,["prevent","stop"])),onDragenter:e[4]||(e[4]=i(o=>n.is_dragover=!0,["prevent","stop"])),onDragleave:e[5]||(e[5]=i(o=>n.is_dragover=!1,["prevent","stop"])),onDrop:e[6]||(e[6]=i(o=>a.upload(o),["prevent","stop"]))},[s("h5",null,u(t.$t("upload.drop")),1)],34),s("input",{type:"file",multiple:"",onChange:e[7]||(e[7]=o=>a.upload(o))},null,32),Y,(d(!0),c(D,null,C(n.uploads,o=>(d(),c("div",{class:"mb-4",key:o.name},[s("div",{class:f(["font-bold text-sm",o.text_class])},[s("i",{class:f(o.icon)},null,2),q(" "+u(o.name),1)],2),s("div",Q,[s("div",{class:f(["transition-all progress-bar",o.variant]),style:R({width:o.current_progress+"%"})},null,6)])]))),128))])])}const X=v(P,[["render",W]]),Z={name:"CompositionItem",components:{ErrorMessage:B},props:{song:{type:Object,required:!0},updateSong:{type:Function,required:!0},index:{type:Number,required:!0},removeSong:{type:Function,required:!0},updateUnsavedFlag:{type:Function}},data(){return{showForm:!1,schema:{modified_name:"required",genre:"alpha_spaces"},in_submission:!1,show_alert:!1,alert_variant:"bg-blue-500",alert_message:"Please wait! Updating song info."}},methods:{async edit(t){this.in_submission=!0,this.show_alert=!0,this.alert_variant="bg-blue-500",this.alert_message="Please wait! Updating song info.";const e=y(x,`songs/${this.song.docID}`);try{await N(e,t)}catch(r){console.log("error while updating",r),this.in_submission=!1,this.alert_variant="bg-red-500",this.alert_message="Something went wrong! Try again later";return}this.updateSong(this.index,t),this.updateUnsavedFlag(!1),this.in_submission=!1,this.alert_variant="bg-green-500",this.alert_message="Success!"},async deleteSong(){const t=F(k,`songs/${this.song.original_name}`);M(t).then(()=>{console.log("File deleted successfully")}).catch(e=>{console.log("error while deleting the file",e)}),await V(y(x,"songs",this.song.docID)),this.removeSong(this.index)}}},ee={class:"border border-gray-200 p-3 mb-4 rounded"},se={class:"inline-block text-2xl font-bold"},te=s("i",{class:"fa fa-times"},null,-1),oe=[te],ne=s("i",{class:"fa fa-pencil-alt"},null,-1),ae=[ne],re={class:"mb-3"},ie=s("label",{class:"inline-block mb-2"},"Song Title",-1),le={class:"mb-3"},de=s("label",{class:"inline-block mb-2"},"Genre",-1),ge=["disabled"],ue=["disabled"];function ce(t,e,r,p,n,a){const o=_("vee-field"),l=_("ErrorMessage"),m=_("vee-form");return d(),c("div",ee,[w(s("div",null,[s("h4",se,u(r.song.modified_name),1),s("button",{class:"ml-1 py-1 px-2 text-sm rounded text-white bg-red-600 float-right",onClick:e[0]||(e[0]=i((...g)=>a.deleteSong&&a.deleteSong(...g),["prevent"]))},oe),s("button",{class:"ml-1 py-1 px-2 text-sm rounded text-white bg-blue-600 float-right",onClick:e[1]||(e[1]=i(g=>n.showForm=!n.showForm,["prevent"]))},ae)],512),[[S,!n.showForm]]),w(s("div",null,[n.show_alert?(d(),c("div",{key:0,class:f(["text-white text-center font-bold p-4",n.alert_variant])},u(n.alert_message),3)):j("",!0),h(m,{"validation-schema":n.schema,"initial-values":r.song,onSubmit:a.edit},{default:z(()=>[s("div",re,[ie,h(o,{type:"text",name:"modified_name",class:"block w-full py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded",placeholder:"Enter Song Title",onInput:e[2]||(e[2]=g=>r.updateUnsavedFlag(!0))}),h(l,{class:"text-red-600",name:"modified_name"})]),s("div",le,[de,h(o,{type:"text",name:"genre",class:"block w-full py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded",placeholder:"Enter Genre",onInput:e[3]||(e[3]=g=>r.updateUnsavedFlag(!0))}),h(l,{class:"text-red-600",name:"genre"})]),s("button",{type:"submit",class:"py-1.5 px-3 rounded text-white bg-green-600",disabled:n.in_submission},u(t.$t("song.submit_btn")),9,ge),s("button",{type:"button",class:"py-1.5 px-3 rounded text-white bg-gray-600",disabled:n.in_submission,onClick:e[4]||(e[4]=i(g=>n.showForm=!1,["prevent"]))},u(t.$t("song.go_back")),9,ue)]),_:1},8,["validation-schema","initial-values","onSubmit"])],512),[[S,n.showForm]])])}const pe=v(Z,[["render",ce]]),me={name:"manage-view",components:{AppUpload:X,CompositionItem:pe},data(){return{songs:[],unsavedFlag:!1}},async created(){const t=A(U,G("uid","==",b.currentUser.uid));(await L(t)).forEach(this.addSong)},methods:{updateSong(t,e){this.songs[t].modified_name=e.modified_name,this.songs[t].genre=e.genre},removeSong(t){this.songs.splice(t,1)},addSong(t){const e={...t.data(),docID:t.id};this.songs.push(e)},updateUnsavedFlag(t){this.unsavedFlag=t}},beforeRouteLeave(t,e,r){if(!this.unsavedFlag)r();else{const p=confirm("You have unsaved changes. Are you sure you want to leave?");r(p)}}},he={class:"container mx-auto mt-6"},fe={class:"md:grid md:grid-cols-3 md:gap-4"},_e={class:"col-span-1"},be={class:"col-span-2"},ve={class:"bg-white rounded border border-gray-200 relative flex flex-col"},ye={class:"px-6 pt-6 pb-5 font-bold border-b border-gray-200"},xe={class:"card-title"},we=s("i",{class:"fa fa-compact-disc float-right text-green-400 text-2xl"},null,-1),Se={class:"p-6"};function Fe(t,e,r,p,n,a){const o=_("app-upload"),l=_("composition-item");return d(),c("section",he,[s("div",fe,[s("div",_e,[h(o,{ref:"upload",addSong:a.addSong},null,8,["addSong"])]),s("div",be,[s("div",ve,[s("div",ye,[s("span",xe,u(t.$t("manage.my_songs")),1),we]),s("div",Se,[(d(!0),c(D,null,C(n.songs,(m,g)=>(d(),O(l,{key:m.docID,song:m,updateSong:a.updateSong,index:g,removeSong:a.removeSong,updateUnsavedFlag:a.updateUnsavedFlag},null,8,["song","updateSong","index","removeSong","updateUnsavedFlag"]))),128))])])])])])}const Ue=v(me,[["render",Fe]]);export{Ue as default};
