import{_ as k,E as S,L as u,M as D,N as _,e as P,g,s as h,O as E,v as b,z as M,D as q,R as N,K as V,P as p,f as z,r as d,o as m,c,a as e,A as B,n as f,t as n,J as y,m as I,w as L,b as w,i as U,Q as $,j as R,l as j}from"./index-6b728ebc.js";const A={name:"SongView",components:{ErrorMessage:S},data(){return{song:{},schema:{comment:"required|min:3"},comment_in_submission:!1,comment_show_alert:!1,comment_alert_variant:"bg-blue-500",comment_alert_message:"Please wait! Your comment is being submitted!",comments:[],sort:"1"}},props:["comment"],computed:{...u(D,["userLoggedIn"]),...u(_,["playing"]),sortedComments(){return this.comments.slice().sort((t,o)=>this.sort==="1"?new Date(o.datePosted)-new Date(t.datePosted):new Date(t.datePosted)-new Date(o.datePosted))}},async beforeRouteEnter(t,o,a){const l=await P(g(h,t.params.id));a(s=>{if(!l.exists()){s.$router.push({name:"home"});return}const{sort:i}=s.$route.query;s.sort=i==="1"||i==="2"?i:"1",s.song=l.data(),s.getComments()})},methods:{...E(_,["newSong"]),async addComment(t,{resetForm:o}){this.comment_in_submission=!0,this.comment_show_alert=!0,this.comment_alert_variant="bg-blue-500",this.comment_alert_message="Please wait! Your comment is being submitted!-blue-500";const a={content:t.comment,datePosted:new Date().toString(),sid:this.$route.params.id,name:b.currentUser.displayName,uid:b.currentUser.uid};await M(p,a),this.song.comment_count+=1,await q(g(h,this.$route.params.id),{comment_count:this.song.comment_count}),this.getComments(),this.comment_in_submission=!1,this.comment_alert_variant="bg-green-500",this.comment_alert_message="Comment added!",o()},async getComments(){const t=N(p,V("sid","==",this.$route.params.id)),o=await z(t);this.comments=[],o.forEach(a=>{this.comments.push({docID:a.id,...a.data()})})}},watch:{sort(t){t!==this.$route.query.sort&&this.$router.push({query:{sort:t}})}}},Y={class:"w-full mb-8 py-14 text-center text-white relative"},F=e("div",{class:"absolute inset-0 w-full h-full box-border bg-contain music-bg",style:{"background-image":"url(/assets/img/song-header.png)"}},null,-1),J={class:"container mx-auto flex items-center"},K={class:"z-50 text-left ml-8"},O={class:"text-3xl font-bold"},Q={class:"song-price"},G={class:"container mx-auto mt-6",id:"comments"},H={class:"bg-white rounded border border-gray-200 relative flex flex-col"},T={class:"px-6 pt-6 pb-5 font-bold border-b border-gray-200"},W={class:"card-title"},X=e("i",{class:"fa fa-comments float-right text-green-400 text-2xl"},null,-1),Z={class:"p-6"},ee=["disabled"],te={value:"1"},se={value:"2"},oe={class:"container mx-auto"},ne={class:"mb-5"},ae={class:"font-bold"};function re(t,o,a,l,s,i){const v=d("vee-field"),x=d("ErrorMessage"),C=d("vee-form");return m(),c("main",null,[e("section",Y,[F,e("div",J,[e("button",{id:"play-btn",onClick:o[0]||(o[0]=B(r=>t.newSong(s.song),["prevent"])),type:"button",class:"z-50 h-24 w-24 text-3xl bg-white text-black rounded-full focus:outline-none"},[e("i",{class:f(["fas",{"fa-play":!t.playing,"fa-pause":t.playing}])},null,2)]),e("div",K,[e("div",O,n(s.song.modified_name),1),e("div",null,n(s.song.genre),1),e("div",Q,n(t.$n(1,"currency","ja")),1)])])]),e("section",G,[e("div",H,[e("div",T,[e("span",W,n(t.$tc("song.comment_count",s.song.comment_count,{count:s.song.comment_count})),1),X]),e("div",Z,[s.comment_show_alert?(m(),c("div",{key:0,class:f(["text-white text-center font-bold p-4 mb-4",s.comment_alert_variant])},n(s.comment_alert_message),3)):y("",!0),t.userLoggedIn?(m(),I(C,{key:1,"validation-schema":s.schema,onSubmit:i.addComment},{default:L(()=>[w(v,{as:"textarea",name:"comment",class:"block w-full py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded mb-4",placeholder:t.$t("song.comment_placeholder")},null,8,["placeholder"]),w(x,{class:"text-red-600",name:"comment"}),e("button",{type:"submit",class:"py-1.5 px-3 rounded text-white bg-green-600 block",disabled:s.comment_in_submission},n(t.$t("song.submit_btn")),9,ee)]),_:1},8,["validation-schema","onSubmit"])):y("",!0),U(e("select",{class:"block mt-4 py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded","onUpdate:modelValue":o[1]||(o[1]=r=>s.sort=r)},[e("option",te,n(t.$t("song.sort_latest")),1),e("option",se,n(t.$t("song.sort_oldest")),1)],512),[[$,s.sort]])])])]),e("ul",oe,[(m(!0),c(R,null,j(i.sortedComments,r=>(m(),c("li",{class:"p-6 bg-gray-50 border border-gray-200",key:r.docID},[e("div",ne,[e("div",ae,n(r.name),1),e("time",null,n(r.datePosted),1)]),e("p",null,n(r.content),1)]))),128))])])}const me=k(A,[["render",re]]);export{me as default};
